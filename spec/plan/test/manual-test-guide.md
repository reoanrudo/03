# 手動テストガイド - 曲学習機能

## 前提条件
- [ ] 開発サーバーが起動していること
- [ ] Playwrightがインストールされていること
- [ ] ブラウザ（Chrome）が使用可能なこと

## 準備

PlaywrightはHomebrewでインストールされます：
```bash
# Playwrightがインストール済みの場合、以下のコマンドでブラウザをインストールできます
npx playwright install chromium
```

## 開発サーバー起動確認

開発サーバーが起動していることを確認します：

```bash
cd frontend
npm run dev
```

期待される結果：
- サーバーが `http://localhost:3000` で起動すること
- コンソールに以下のようなメッセージが表示されること：
```
  VITE v6.4.1  ready in XXX ms
  ➜  Local:   http://localhost:3000/
  ➜  Network: http://10.239.209.208:3000/
```

---

## テスト1: SongSelector - 難易度フィルタリング

### 操作手順

1. ブラウザで `http://localhost:3000` を開く
2. 以下のテストを順次に実行する

#### テスト1-1: 「全て」フィルター

**操作**:
1. 画面上の「全て」ボタンをクリック

**期待される結果**:
- [ ] 全ての曲（3曲）が表示されていること
  - きらきら星（初級）
  - Wonder Wall（中級）
  - Stairway to Heaven（上級）

**確認ポイント**:
- [ ] ボタンがオレンジ色（灰色/白）であること
- [ ] スケールエフェクト（`scale-110`）が表示されること

---

#### テスト1-2: 「初級」フィルター

**操作**:
1. 「初級」ボタンをクリック

**期待される結果**:
- [ ] 初級曲のみが表示されていること
  - きらきら星（初級）のみ

**確認ポイント**:
- [ ] ボタンの色が緑色（`bg-green-500`）であること
- [ ] 他の曲が表示されないこと
- [ ] 進捗情報が表示されないこと

---

#### テスト1-3: 「中級」フィルター

**操作**:
1. 「中級」ボタンをクリック

**期待される結果**:
- [ ] 中級曲のみが表示されていること
  - Wonder Wall（中級）のみ

**確認ポイント**:
- [ ] ボタンの色が黄色（`bg-yellow-500`）であること
- [ ] 他の曲が表示されないこと
- [ ] 進捗情報が表示されないこと

---

#### テスト1-4: 「上級」フィルター

**操作**:
1. 「上級」ボタンをクリック

**期待される結果**:
- [ ] 上級曲のみが表示されていること
  - Stairway to Heaven（上級）のみ

**確認ポイント**:
- [ ] ボタンの色が赤色（`bg-red-500`）であること
- [ ] 他の曲が表示されないこと
- [ ] 進捗情報が表示されないこと

---

#### テスト1-5: フィルター切り替えのアニメーション

**確認ポイント**:
- [ ] ボタンクリック時にスムーズな拡大・縮小アニメーションがあること
- [ ] アクティブなボタンに影（`shadow-lg`）があること
- [ ] ホバー時に拡大（`scale-105`）があること

---

#### テスト1-6: レスポンシブ対応

**操作**:
1. ブラウザウィンドウサイズを変更する
   - タブレットサイズ（768px以下）に変更
   - ラージサイズ（1024px以上）に変更

**期待される結果**:
- [ ] 画面が崩壊していないこと
- [ ] レスポンシブが正しく機能すること
  - `md:grid-cols-1` - タブレットで1列表示
  - `lg:grid-cols-1` - ラージで1列表示

---

#### テスト1-7: 進捗表示の確認

**前提条件**: 進捗データがlocalStorageにあること

**操作**:
1. localStorageに進捗データがある場合、ページをリロード（Cmd+R）
2. 進捗情報が表示されることを確認

**期待される結果**:
- [ ] 進捗がある曲に「ベストスコア」と「クリア回数」が表示されること
- [ ] 数値が正しく表示されること
- [ ] スコアが3桁区切りで表示されていること（例: 5,000）

---

## テスト2: 曲選択と演奏開始

### 前提条件
- [ ] SongSelector画面が表示されていること
- [ ] 難易度フィルターが正常に機能すること

#### テスト2-1: 曲を選択して演奏開始

**操作**:
1. 任意の曲をクリック（例: きらきら星）
2. 「演奏開始」ボタンをクリック

**期待される結果**:
- [ ] PC Player画面が表示されること
- [ ] 選択した曲のタイトルとアーティストがPC Playerの上部に表示されること
- [ ] 演奏開始ボタンが表示されること
- [ ] 演奏が開始されること（Videoが表示され始める）

**確認ポイント**:
- [ ] 画面遷移がスムーズであること
- [ ] コンソールにエラーがないこと

---

#### テスト2-2: キャンセルして選択する

**操作**:
1. SongSelector画面で「演奏開始」ボタンをクリック
2. PC Player画面が表示されたら、右上の「Abort」ボタンをクリック

**期待される結果**:
- [ ] SongSelector画面に戻ること
- [ ] 進捗データが保持されていること（クリア回数はリセットされない）

---

## テスト3: 進捗保存・読み込み

### テスト3-1: 初回演奏で進捗データの作成

**操作**:
1. 任意の曲を選択
2. 「演奏開始」ボタンをクリック
3. 数秒間演奏する（または曲が終了するまで待つ）

**期待される結果**:
- [ ] 演奏が開始されること
- [ ] スコアが表示されていること
- [ ] ノーツがヒット/ミスすること

**確認ポイント**:
- [ ] PERFECTヒット: 1000点が加算されること
- [ ] GREATヒット: 500点が加算されること
- [ ] ミス時: コンボが0にリセットされること
- [ ] ヒット時: パーティクルエフェクトが表示されること

---

### テスト3-2: localStorageの確認

**操作**:
1. ブラウザの開発者ツールを開く（F12 または Cmd+Option+I）
2. 左側メニューから「Application」タブをクリック
3. 左側メニューから「Local Storage」を展開
4. `http://localhost:3000` をクリック
5. 左側メニューから「Storage」タブをクリック

**期待される結果**:
- [ ] `air-guitar-progress` というキーが存在すること
- [ ] 値が JSON 配列であること
- [ ] 演奏した曲のデータが含まれていること

**データ構造の確認**:
```json
[
  {
    "songId": "twinkle-easy",
    "bestScore": 5000,
    "clearCount": 0,
    "lastPlayed": "2026-01-29T08:30:00.000Z"
  }
]
```

---

### テスト3-3: リロード後の進捗表示

**操作**:
1. ページをリロードする（Cmd+R または F5）

**期待される結果**:
- [ ] 進捗データが保持されていること
- [ ] ベストスコアとクリア回数が表示されていること

---

### テスト3-4: クリア時のメッセージ確認

**操作**:
1. 曲を80%以上のヒット率で演奏する
2. 演奏終了を待つ

**期待される結果**:
- [ ] 演奏終了時に「曲クリア！」メッセージが表示されること
- [ ] メッセージの色が緑色（`#22c55e`）であること
- [ ] メッセージが数秒間表示されること

---

### テスト3-5: クリア回数の増加

**操作**:
1. 同じ曲を再選択
2. 前回より高いスコアを目指して演奏する

**期待される結果**:
- [ ] 演奏終了時にクリア回数が増加していること
- [ ] クリア回数が 1回増加していること

---

### テスト3-6: localStorageのクリア

**操作**:
1. 開発者ツールの「Application」タブを開く
2. 「Local Storage」タブをクリック
3. `http://localhost:3000` をクリック
4. 削除ボタンをクリック

**期待される結果**:
- [ ] `air-guitar-progress` が削除されていること
- [ ] ページをリロードする
- [ ] 進捗情報が表示されないこと

---

### テスト3-7: 複数曲の進捗

**操作**:
1. 複数の曲を演奏する
2. それぞれの曲で異なるスコアを記録する

**期待される結果**:
- [ ] 全ての曲の進捗データが保存されていること
- [ ] 各曲のベストスコアとクリア回数が正しく表示されていること

---

## トラブルシューティング

### 問題: Playwrightが起動しない

**解決方法**:
```bash
# Playwrightを再インストール
npm install @playwright/test -D
npx playwright install chromium
```

### 問題: ノーツが表示されない

**確認事項**:
- [ ] カメラのWebカメラへのアクセスを許可すること
- [ ] TensorFlow.jsのモデルがロードされること
- [ ] 手の骨格が検知されること

### 問題: スコアが表示されない

**確認事項**:
- [ ] ノーツがヒット/ミスされていること
- [ ] スコアが正しく計算されていること
- [ ] コンボ数が表示されていること

---

## テスト完了チェックリスト

### Phase 4-1: 難易度フィルタリング
- [ ] 「全て」ボタンで全曲が表示されること
- [ ] 「初級」ボタンで初級曲のみが表示されること
- [ ] 「中級」ボタンで中級曲のみが表示されること
- [ ] 「上級」ボタンで上級曲のみが表示されること
- [ ] 色分けが正しいこと
- [ ] アニメーションがスムーズであること
- [ ] レスポンシブが正常に機能すること

### Phase 4-2: 進捗保存・読み込み
- [ ] 初回演奏で進捗データが作成されること
- [ ] localStorage に進捗データが保存されること
- [ ] リロード後に進捗が表示されること
- [ ] ベストスコアが更新されること
- [ ] クリア回数が増加すること
- [ ] 未クリア演奏でクリア回数が増加しないこと
- [ ] localStorage のクリアでリセットが機能すること

### Phase 4-3: 既存機能との互換性確認
- [ ] 既存の演奏機能が正常に動作すること
- [ ] WebRTC通信が正常に機能すること
- [ ] コンボシステムが機能すること
- [ ] スコアシステムが機能すること
- [ ] 既存のコードショートカットが機能すること

### Phase 4-4: パフォーマンス最適化
- [ ] React.memo が適切に使用されていること
- [ ] useCallback が適切に使用されていること
- [ ] 不必要な再レンダリングが防止されていること
- [ ] localStorage アクセスが最小化されていること

---

## テスト完了後

全てのテストを完了したら、以下の情報を記入してください：

1. バグが見つかった場合：
   - バグの詳細
   - 再現手順
   - 期待される振舞い

2. 正常に動作した場合：
   - 成功したテスト項目

---

## 開発サーバーの停止

テスト完了後、開発サーバーを停止するには以下を実行してください：

```bash
# 方法1: ターミナルで Ctrl+C
# 方法2: 別のプロセスを終了
```

---

## 注意事項

### ビデオ設定
- 演奏を開始する前に、ブラウザのオーディオ出力デバイスを確認してください
- Webカメラへのアクセス許可を求められる場合、許可を与えてください

### カメラ設定
- 部屋の明るい場所でテストすることを推奨
- 手とカメラがカメラに収まるように配置すること

### 進捗管理
- テスト中はlocalStorageのクリア機能を使用しないことを推奨
- テストが終了したら、localStorage のデータをクリアして次のテストの影響を避けてください

---

## 参考資料

### プロジェクト構造
- `frontend/` - フロントエンドコード
- `frontend/components/SongSelector.tsx` - 曲選択画面
- `frontend/components/PCPlayer.tsx` - 演奏画面
- `frontend/services/ProgressService.ts` - 進捗管理
- `frontend/services/songData.ts` - 曲データ

### 既存の演奏機能
- ランダムノーツモード（曲選択しない場合）
- ハンドトラッキングとストラム判定
- スコアシステム
- コンボシステム
- オーディオシステム

---

**テスト実施日**: 未定

**テスト担当者**: 未定
